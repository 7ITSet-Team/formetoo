!function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="public/",n(n.s=27)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@babel/runtime/regenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/asyncToGenerator")},function(e,t){e.exports=require("@babel/runtime/helpers/classCallCheck")},function(e,t){e.exports=require("@babel/runtime/helpers/createClass")},function(e,t){e.exports=require("@babel/runtime/helpers/possibleConstructorReturn")},function(e,t){e.exports=require("@babel/runtime/helpers/getPrototypeOf")},function(e,t){e.exports=require("@babel/runtime/helpers/inherits")},function(e,t){e.exports=require("react-router-dom")},function(e,t){e.exports=require("mongoose")},function(e,t,n){"use strict";t.a={connection:{port:8082},jwt:{secret:"SYW/:ZIFrxd')ueR#<Oj,ABzutT]QI({%MekfS9(l|7NM-&m6RTgP@)X44sOGVE",lifetime:2592e6},db:{url:"mongodb://localhost/formetoo"},nodemailer:{host:"smtp.gmail.com",port:465,secure:!0,auth:{user:"formetood@gmail.com",pass:"topotop123"}},contacts:{support:{mail:"support@formetoo.ru"}}}},function(e,t){e.exports=require("jsonwebtoken")},function(e,t){e.exports=require("bcryptjs")},function(e,t){e.exports=require("nodemailer")},function(e,t,n){"use strict";var r=n(1),a=n.n(r),s=n(2),o=n.n(s),i=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.category.getAll();case 2:return o=e.sent,e.abrupt("return",{result:o});case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),u=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.slug,e.next=3,t.category.getBySlug(o);case 3:return i=e.sent,e.next=6,i.getProducts();case 6:return u=e.sent,e.abrupt("return",{result:u});case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),c=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.slug,e.next=3,t.product.getBySlug(o);case 3:return i=e.sent,e.abrupt("return",{result:i});case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),l=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.slug,e.next=3,t.page.getBySlug(o);case 3:return i=e.sent,e.abrupt("return",{result:i});case 5:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),p=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.page.getMainMenu();case 2:return o=e.sent,e.abrupt("return",{result:o});case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),m=n(12),d=n.n(m),h=n(11),f=n.n(h),v=n(10),y=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c,l,p;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.email,i=s.password,e.next=3,t.user.getByEmail(o);case 3:if(u=e.sent,c={result:void 0,error:"incorrect login-password pair"},u){e.next=7;break}return e.abrupt("return",c);case 7:if(u.isActive){e.next=9;break}return e.abrupt("return",{result:void 0,error:"need to activate account"});case 9:return e.next=11,d.a.compare(i,u.password);case 11:if(!e.sent){e.next=21;break}return e.next=15,u.getPermissions();case 15:return l=e.sent,p=f.a.sign({id:u._id},v.a.jwt.secret),r.cookie("JWT",p,{maxAge:v.a.jwt.lifetime,httpOnly:!1}),e.abrupt("return",{result:{permissions:l,user:{email:u.email,phone:u.phone,name:u.name,lastname:u.lastname}}});case 21:return e.abrupt("return",c);case 22:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),g=function(){var e=o()(a.a.mark(function e(t,n,r,s){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.clearCookie("JWT"),e.abrupt("return");case 2:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),k=n(13),E=n.n(k),b=function(e){return"\n<p>\n    Здравствуйте! Спасибо за вашу регистрацию на сайте http://formetoo.ru! Чтобы активировать аккаунт, нажмите на кнопку ниже: \n</p>\n<p>\n    <a href=".concat(e.link,">Завершить регистрацию</a>\n</p>\n")},w=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c,l,p,m,h,f,y,g,k;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.password,i=s.phone,u=s.email,c=s.name,l=s.lastname,u=u.toLowerCase(),e.next=4,t.user.getByEmail(u);case 4:if(!e.sent){e.next=7;break}return e.abrupt("return",{result:void 0,error:"этот email уже занят"});case 7:return e.next=9,d.a.genSalt(10);case 9:return p=e.sent,e.next=12,d.a.hash(o,p);case 12:return m=e.sent,e.next=15,new t.user({email:u,phone:i,password:m,name:c,lastname:l,role:"client",isActive:!1}).save();case 15:if(h=e.sent,!n.cookies.orderJWT){e.next=19;break}return e.next=19,t.order.setLinkOnUser(n.cookies.orderJWT,h);case 19:return f=E.a.createTransport(v.a.nodemailer),y=n.protocol+"://"+n.hostname,g="".concat(y,"/account/verify/").concat(h._id),k={from:v.a.contacts.support.mail,to:u,subject:"Account activation",html:b({link:g})},f.sendMail(k,function(e){if(e)throw e}),e.abrupt("return");case 25:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),x=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.id,e.next=3,t.user.activateById(o);case 3:return i=f.a.sign({id:o},v.a.jwt.secret),r.cookie("JWT",i,{maxAge:v.a.jwt.lifetime,httpOnly:!1}),e.abrupt("return");case 6:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),S=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if((o={authorised:!!s.userByToken,permissions:[],user:{}}).authorised){e.next=3;break}return e.abrupt("return",{result:o});case 3:return e.next=5,s.userByToken.getPermissions();case 5:return o.permissions=e.sent,o.user={email:s.userByToken.email,phone:s.userByToken.phone,name:s.userByToken.name,lastname:s.userByToken.lastname},e.abrupt("return",{result:o});case 8:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),C=function(e){return"\n<p>\n    Здравствуйте! Для восстановления пароля, нажмите на кнопку ниже: \n</p>\n<p>\n    <a href=".concat(e.link,">Восстановить</a>\n</p>\n")},N=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c,l,p,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.type,i=s.identificator,u=void 0,"email"!==o){e.next=9;break}return i=i.toLowerCase(),e.next=6,t.user.getByEmail(i);case 6:u=e.sent,e.next=13;break;case 9:if("phone"!==o){e.next=13;break}return e.next=12,t.user.getByPhone(i);case 12:u=e.sent;case 13:if(u){e.next=15;break}return e.abrupt("return");case 15:return c=E.a.createTransport(v.a.nodemailer),l=n.protocol+"://"+n.hostname,p="".concat(l,"/account/recovery/").concat(u.email,"/").concat(u._id),m={from:v.a.contacts.support.mail,to:u.email,subject:"Account recovery",html:C({link:p})},c.sendMail(m,function(e){if(e)throw e}),e.abrupt("return");case 21:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),q=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=s.id,i=s.password,(u=s.userByToken)||!o){e.next=6;break}return e.next=5,t.user.getByID(o);case 5:u=e.sent;case 6:if(u){e.next=8;break}return e.abrupt("return");case 8:return e.next=10,d.a.genSalt(10);case 10:return c=e.sent,e.next=13,d.a.hash(i,c);case 13:return u.password=e.sent,u.save(),e.abrupt("return");case 16:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),I=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.order.getByUserOrOrderToken(s.userByToken,n.cookies.orderJWT);case 2:if(o=e.sent){e.next=5;break}return e.abrupt("return");case 5:return e.next=7,o.cart();case 7:return i=e.sent,e.abrupt("return",{result:i});case 9:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),T=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.userByToken,e.next=3,t.order.getByUserOrOrderToken(o,n.cookies.orderJWT);case 3:if(i=e.sent){e.next=6;break}return e.abrupt("return");case 6:return i.setStatus("ordered"),u=E.a.createTransport(v.a.nodemailer),c={from:v.a.contacts.support.mail,to:o.email,subject:"Thanks for your order",html:"\n<p>\n    Здравствуйте! Ваш заказ был успешно принят. В данный момент он обрабатывается.\n</p>\n"},u.sendMail(c,function(e){if(e)throw e}),e.abrupt("return");case 11:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),O=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o,i,u,c,l,p,m;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=s.userByToken,i=s.productID,u=s.count,e.next=3,t.order.getByUserOrOrderToken(o,n.cookies.orderJWT);case 3:if(c=e.sent){e.next=10;break}return e.next=7,t.order.createNewOrder();case 7:c=e.sent,l=f.a.sign({id:c._id},v.a.jwt.secret),r.cookie("orderJWT",l,{maxAge:v.a.jwt.lifetime,httpOnly:!1});case 10:return e.next=12,c.putInOrder(i,u);case 12:if(p=e.sent){e.next=17;break}return e.next=16,c.cart();case 16:m=e.sent;case 17:return e.abrupt("return",{error:p,result:m});case 18:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}(),D=function(){var e=o()(a.a.mark(function e(t,n,r,s){var o;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.role.getAll();case 2:return o=e.sent,e.abrupt("return",{result:o});case 4:case"end":return e.stop()}},e,this)}));return function(t,n,r,a){return e.apply(this,arguments)}}();t.a={quest:{catalog:{categories:i,category:u,product:c},cart:{info:I,"put-in-order":O},content:{page:l,"main-menu":p},auth:{login:y,logout:g,registration:w,verify:x,check:S,forgot:N,"change-password":q}},client:{cart:{"placing-orders":T},roles:{list:D}},media:{},tabs:{},attributes:{},orders:{},users:{},roles:{},categories:{},products:{},pages:{},settings:{},logs:{}}},function(e,t){e.exports=require("@babel/runtime/helpers/assertThisInitialized")},function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),s=n(2),o=n.n(s),i=n(9),u=n.n(i),c=n(11),l=n.n(c),p=n(10),m=n(14),d=function(e){var t=new u.a.Schema({email:{type:String,unique:!0,required:!0},password:{type:String,required:!0},phone:{type:String,unique:!0,required:!0},name:{type:String,required:!0},lastname:{type:String,required:!0},isActive:{type:Boolean,required:!0},role:String},{collection:"user"});t.statics.getByToken=function(){var e=o()(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.a.verify(t,p.a.jwt.secret),e.next=3,this.findOne({_id:new u.a.Types.ObjectId(n.id)});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByID=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({_id:new u.a.Types.ObjectId(t)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByEmail=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=t.toLowerCase(),e.next=3,this.findOne({email:t});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByPhone=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({phone:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.activateById=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.update({_id:new u.a.Types.ObjectId(t)},{$set:{isActive:!0}});case 2:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.methods.getPermissions=o()(a.a.mark(function t(){var n,r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(this.role){t.next=2;break}return t.abrupt("return",[]);case 2:if("root"!==this.role){t.next=6;break}return(n=Object.keys(m.a)).splice(n.indexOf("quest"),1),t.abrupt("return",n);case 6:return t.next=8,e.role.getByName(this.role);case 8:if(r=t.sent){t.next=11;break}return t.abrupt("return",[]);case 11:return t.abrupt("return",r.permissions||[]);case 12:case"end":return t.stop()}},t,this)})),t.set("autoIndex",!1),e.user=u.a.model("user",t)},h=function(e){var t=new u.a.Schema({name:{type:String,unique:!0,required:!0},alias:String,permissions:[String]},{collection:"role"});t.statics.getByName=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({name:t});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getAll=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find({},{_id:0,__v:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),t.set("autoIndex",!1),e.role=u.a.model("role",t)},f=function(e){var t=new u.a.Schema({userID:u.a.Schema.Types.ObjectId,createDate:Date,products:[],statusDate:Date,status:{type:String,required:!0},finalSum:Number},{collection:"order"});t.statics.getByUser=function(){var e=o()(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find({userID:new u.a.Types.ObjectId(t._id),status:{$not:{$eq:"closed"}}});case 2:if(!((n=e.sent)&&n.length>0)){e.next=5;break}return e.abrupt("return",n.sort(function(e,t){return t.createDate-e.createDate})[0]);case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByOrderToken=function(){var e=o()(a.a.mark(function e(t){var n;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.a.verify(t,p.a.jwt.secret),e.next=3,this.findOne({_id:new u.a.Types.ObjectId(n.id),status:{$not:{$eq:"closed"}}});case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByUserOrOrderToken=function(){var e=o()(a.a.mark(function e(t,n){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=4;break}return e.next=3,this.getByUser(t);case 3:return e.abrupt("return",e.sent);case 4:if(!n){e.next=8;break}return e.next=7,this.getByOrderToken(n);case 7:return e.abrupt("return",e.sent);case 8:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),t.statics.createNewOrder=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new this({userID:t?t._id:void 0,createDate:new Date,products:[],statusDate:new Date,status:"created"}).save();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.setLinkOnUser=function(){var e=o()(a.a.mark(function e(t,n){var r;return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=l.a.verify(t,p.a.jwt.secret),e.next=3,this.update({_id:new u.a.Types.ObjectId(r.id)},{$set:{userID:new u.a.Types.ObjectId(n._id)}});case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),t.methods.putInOrder=function(){var t=o()(a.a.mark(function t(n,r){var s,o;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(s=!1,this.products.forEach(function(e){e._id.equals(n)&&(e.count=Math.max(r,0),s=!0)}),!s){t.next=7;break}return this.markModified("products"),t.next=6,this.save();case 6:return t.abrupt("return");case 7:return t.next=9,e.product.findOne({_id:n},{__v:0});case 9:if(o=t.sent){t.next=12;break}return t.abrupt("return","Продукт не найден");case 12:return this.products.push({count:Math.max(r,0),_id:o._id}),t.next=15,this.save();case 15:return t.abrupt("return");case 16:case"end":return t.stop()}},t,this)}));return function(e,n){return t.apply(this,arguments)}}(),t.methods.setStatus=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.status=t,e.next=3,this.save();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.methods.cart=o()(a.a.mark(function t(){var n,r,s,o,i,u;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n={},r=0,s=0,o=this.products.map(function(e){return n[e._id]=e.count,e._id}),t.next=6,e.product.find({_id:{$in:o}},{__v:0});case 6:return i=t.sent,u=i.map(function(e){var t=e.toObject();return t.count=n[t._id]||0,s+=t.count,r+=t.count*t.price,t}),t.abrupt("return",{products:u,count:s,sum:r});case 9:case"end":return t.stop()}},t,this)})),t.set("autoIndex",!1),e.order=u.a.model("order",t)},v=function(e){var t=new u.a.Schema({categoryID:{type:u.a.Schema.Types.ObjectId,required:!0},code:{type:String,unique:!0},name:{type:String,unique:!0,required:!0},slug:{type:String,unique:!0,required:!0},price:{type:Number,required:!0},media:[String],props:[{name:{type:String,unique:!0,required:!0},value:{}}]},{collection:"product"});t.statics.getBySlug=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({slug:t},{__v:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.statics.getByCategoryID=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find({categoryID:new u.a.Types.ObjectId(t)},{__v:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.set("autoIndex",!1),e.product=u.a.model("product",t)},y=function(e){var t=new u.a.Schema({slug:{type:String,unique:!0},name:{type:String,required:!0,unique:!0},title:{type:String,unique:!0},content:{type:String},position:{type:Number,required:!0}},{collection:"page"});t.statics.getMainMenu=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find({},{_id:0,slug:1,name:1},{sort:{position:1}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),t.statics.getBySlug=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({slug:t},{_id:0,__v:0,position:0,name:0,slug:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.set("autoIndex",!1),e.page=u.a.model("page",t)},g=function(e){var t=new u.a.Schema({name:{type:String,required:!0,unique:!0},img:String,slug:{type:String,required:!0,unique:!0}},{collection:"category",autoIndex:!1});t.statics.getAll=o()(a.a.mark(function e(){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.find({},{_id:0,__v:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)})),t.statics.getBySlug=function(){var e=o()(a.a.mark(function e(t){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.findOne({slug:t},{__v:0});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.methods.getProducts=o()(a.a.mark(function t(){return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.product.getByCategoryID(this._id);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}},t,this)})),t.set("autoIndex",!1),e.category=u.a.model("category",t)};n.d(t,"user",function(){return d}),n.d(t,"role",function(){return h}),n.d(t,"order",function(){return f}),n.d(t,"product",function(){return v}),n.d(t,"page",function(){return y}),n.d(t,"category",function(){return g})},function(e,t){e.exports=require("@babel/runtime/helpers/defineProperty")},function(e,t){e.exports=require("react-dom")},function(e,t){e.exports=require("jssha")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("react-dom/server")},,function(e,t){e.exports=require("axios")},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";n.r(t);var r=n(20),a=n.n(r),s=n(21),o=n.n(s),i=n(22),u=n.n(i),c=n(10),l=n(1),p=n.n(l),m=n(2),d=n.n(m),h=n(3),f=n.n(h),v=n(4),y=n.n(v),g=n(9),k=n.n(g),E=n(14),b=n(16),w=function(){function e(){f()(this,e)}return y()(e,null,[{key:"init",value:function(){k.a.connect(c.a.db.url,{autoIndex:!1}),k.a.connection.on("error",console.error.bind(console,"connection error:")),k.a.connection.once("open",function(){e.inited=!0}),e.db={},Object.keys(b).forEach(function(t){return b[t](e.db)})}},{key:"getRoute",value:function(){var t=d()(p.a.mark(function t(n,r,a){var s,o,i,u;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.auth(n);case 2:return s=t.sent,o=s.permissions,i=s.user,o.unshift("quest"),o.forEach(function(e){return u=((E.a[e]||{})[r]||{})[a]||u}),t.abrupt("return",{user:i,handler:u});case 8:case"end":return t.stop()}},t,this)}));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"auth",value:function(){var t=d()(p.a.mark(function t(n){var r;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r={permissions:[],user:void 0},n){t.next=3;break}return t.abrupt("return",r);case 3:return t.next=5,e.db.user.getByToken(n);case 5:if(r.user=t.sent,r.user){t.next=8;break}return t.abrupt("return",r);case 8:return t.next=10,r.user.getPermissions();case 10:return r.permissions=t.sent,t.abrupt("return",r);case 12:case"end":return t.stop()}},t,this)}));return function(e){return t.apply(this,arguments)}}()},{key:"router",value:function(){var t=d()(p.a.mark(function t(n,r){var a,s,o,i,u,c,l;return p.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(e.inited){t.next=3;break}return console.log("RPC is not initialized"),t.abrupt("return");case 3:return console.log("===rpc===",n.url,n.body),t.prev=4,a=n.body,s=a.controller,o=a.action,i=a.data,t.next=8,e.getRoute(n.cookies.JWT,s,o);case 8:if(u=t.sent,c=u.user,l=u.handler,i.userByToken=c,!l){t.next=23;break}return t.t0=r,t.next=16,l(e.db,n,r,i);case 16:if(t.t1=t.sent,t.t1){t.next=19;break}t.t1={};case 19:t.t2=t.t1,t.t0.json.call(t.t0,t.t2),t.next=24;break;case 23:r.status(404).json({result:void 0,error:"undefined handler"});case 24:t.next=30;break;case 26:t.prev=26,t.t3=t.catch(4),console.log(t.t3),r.status(500).json({error:"unknown error"});case 30:case"end":return t.stop()}},t,this,[[4,26]])}));return function(e,n){return t.apply(this,arguments)}}()}]),e}(),x=n(0),S=n.n(x),C=n(23),N=n.n(C),q=n(8),I=n(5),T=n.n(I),O=n(6),D=n.n(O),_=n(7),B=n.n(_),R=n(15),j=n.n(R),M=n(17),W=n.n(M),L=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement(q.Link,{to:"/",className:"c--logo"},S.a.createElement("div",null,S.a.createElement("span",null,"For"),S.a.createElement("span",null,"Me"),S.a.createElement("span",null,"Too")),S.a.createElement("div",null,"интернет-магазин"))}}]),t}(S.a.Component),F=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={focused:!1},n.onFocus=function(e){return n.setState({focused:!0})},n.onBlur=function(e){return n.setState({focused:!1})},n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.props,t=e.onChange,n=e.button,r=e.value,a=e.placeholder,s=e.type,o=void 0===s?"text":s,i=this.state.focused;return S.a.createElement("div",{className:"c--input"},S.a.createElement("input",{value:r,placeholder:a,onChange:function(e){return t(e.target.value)},onFocus:this.onFocus,onBlur:this.onBlur,type:o}),n?S.a.createElement("div",{className:"button"},n):null,S.a.createElement("div",{className:"line ".concat(i?"focused":"")}),S.a.createElement("div",{className:"static-line"}))}}]),t}(S.a.Component),P=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={query:""},n.onChange=function(e){return n.setState({query:e})},n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.state.query,t=S.a.createElement(q.Link,{to:"/catalog?query=".concat(e),className:"icon search c--search-btn"});return S.a.createElement(S.a.Fragment,null,S.a.createElement(F,{value:e,placeholder:"Поиск",onChange:this.onChange,button:t}))}}]),t}(S.a.Component),A=n(18),U=n.n(A),$=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.props,n=e.title,r=void 0===n?"":n,a=e.children,s=void 0===a?"":a,o=e.buttons,i=void 0===o?[]:o,u=e.show,c=void 0!==u&&u,l=e.onClose,p=e.className,m=void 0===p?"":p;return c&&t.root?U.a.createPortal(S.a.createElement("div",{className:"c--modal ".concat(m)},S.a.createElement("div",{className:"wrap"},S.a.createElement("div",{className:"background",onClick:function(e){return l&&l()}}),S.a.createElement("div",{className:"form"},S.a.createElement("div",{className:"header"},r),S.a.createElement("div",{className:"content"},s),S.a.createElement("div",{className:"footer c--items-group"},i.map(function(e,t){if(e instanceof S.a.Component)return e;if("function"==typeof e){var n=e;return S.a.createElement(n,{key:t})}return S.a.createElement("button",{onClick:function(t){return e.handler&&e.handler()},key:t,className:"c--btn ".concat(e.types.split(" ").map(function(e){return"c--btn--"+e}).join(" "))},e.name.toUpperCase())}))))),t.root):null}}],[{key:"registerRootID",value:function(e){"undefined"!=typeof window&&(this.root=document.getElementById(e))}}]),t}(S.a.Component),H=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={value:e.value||0},n.onChange=function(e){return n.onChangeValue(e.target.value)},n.decrease=function(e){return n.onChangeValue(Math.max(n.state.value-1,0))},n.increase=function(e){return n.onChangeValue(n.state.value+1)},n}return B()(t,e),y()(t,[{key:"componentWillReceiveProps",value:function(e){e.value!==this.props.value&&this.setState({value:e.value})}},{key:"onChangeValue",value:function(e){var t=this.props.onChange,n=this.state.value;"string"==typeof e&&(e=+e.replace(/[^\d,]+/g,""),e=isNaN(e)?0:e),e!==n&&(this.setState({value:e}),t&&t(e))}},{key:"render",value:function(){var e=this.state.value;return S.a.createElement("div",{className:"c--number-input c--items-group"},S.a.createElement("button",{className:"c--btn c--btn--success",onClick:this.decrease},"-"),S.a.createElement("input",{value:e,onChange:this.onChange}),S.a.createElement("button",{className:"c--btn c--btn--success",onClick:this.increase},"+"))}}]),t}(S.a.Component),J=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={messages:[]},n.refresh=function(e){return n.setState({messages:e})},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){t.refresh=this.refresh}},{key:"componentWillUnmount",value:function(){t.refresh=void 0}},{key:"render",value:function(){var e=this.state.messages;return e&&0!==e.length?U.a.createPortal(S.a.createElement("div",{className:"c--message"},e.map(function(e){return S.a.createElement("div",{key:e.timestamp,className:e.type},e.message)})),t.root):null}}],[{key:"send",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"info";if("string"==typeof t){this.list=this.list||new Set;var r={message:t,type:n,timestamp:(new Date).getTime()};this.list.add(r),setTimeout(function(){e.list.delete(r),e.refresh&&e.refresh(Array.from(e.list).reverse().slice(0,3))},8e3),this.refresh&&this.refresh(Array.from(this.list).reverse().slice(0,3))}}},{key:"registerRootID",value:function(e){"undefined"!=typeof window&&(this.root=document.getElementById(e))}},{key:"type",get:function(){return{success:"success",danger:"danger",info:"info"}}}]),t}(S.a.Component),V=function(e){function t(e){var n;(f()(this,t),(n=T()(this,D()(t).call(this,e))).inverseHorisontal={right:"left",left:"right"},n.inverseVertical={top:"bottom",bottom:"top"},n.state={open:!1,horisontal:"left",vertical:"top"},"string"==typeof e.position)&&e.position.split(" ").forEach(function(e){n.inverseHorisontal[e]?n.state.horisontal=n.inverseHorisontal[e]:n.inverseVertical[e]&&(n.state.vertical=n.inverseVertical[e])});return n.closeAtOutclick=function(e){return!n.thisDOMel.contains(e.target)&&n.setState({open:!1})},n}return B()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.thisDOMel=U.a.findDOMNode(this),window.addEventListener("click",this.closeAtOutclick)}},{key:"componentWillReceiveProps",value:function(e){var t=this,n={};"string"==typeof e.position?e.position.split(" ").forEach(function(e){t.inverseHorisontal[e]?n.horisontal=t.inverseHorisontal[e]:t.inverseVertical[e]&&(n.vertical=t.inverseVertical[e])}):(n.horisontal="left",n.vertical="top");this.setState(n)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("click",this.closeAtOutclick)}},{key:"toggleOpen",value:function(){var e={open:!this.props.disabled&&!this.state.open};if(!this.props.position){var t=this.thisDOMel.getBoundingClientRect(),n=t.x,r=t.y,a=document.body.getBoundingClientRect(),s=a.height,o=a.width/2,i=s/2;e.horisontal=o&&n&&n<o?"left":"right",e.vertical=i&&r?r<i?"top":"bottom":"top"}this.setState(e)}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,r=void 0===n?"":n,a=t.style,s=t.children,o=t.icon,i=void 0===o||o,u=this.state,c=u.open,l=u.horisontal,p=u.vertical,m=[],d=[];S.a.Children.forEach(s,function(e){return(e&&e.props&&"toggle"===e.props.role?m:d).push(e)});var h={};return h[l]=0,h[p]="100%",S.a.createElement("div",{className:"c--dropdown ".concat(r),style:a},S.a.createElement("div",{className:"toggle",onClick:function(t){return e.toggleOpen()}},S.a.createElement("div",null,m),i?S.a.createElement("div",{className:"icon angle_down ".concat(c?"open":"")}):null),c?S.a.createElement("div",{className:"content",style:h},d):null)}}]),t}(S.a.Component),z=n(25),Z=function(){function e(){f()(this,e),z.defaults.headers.post["Access-Control-Allow-Origin"]="*",z.defaults.headers.post["Content-Type"]="application/json"}return y()(e,null,[{key:"request",value:function(){var e=d()(p.a.mark(function e(){var t,n,r,a,s=arguments;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:"",n=s.length>1&&void 0!==s[1]?s[1]:"",r=s.length>2&&void 0!==s[2]?s[2]:{},e.prev=3,e.next=6,z.post("/api",{controller:t,action:n,data:r});case 6:return a=e.sent,e.abrupt("return",{error:a.data.error,data:a.data.result});case 10:return e.prev=10,e.t0=e.catch(3),e.abrupt("return",{error:e.t0,data:void 0});case 13:case"end":return e.stop()}},e,this,[[3,10]])}));return function(){return e.apply(this,arguments)}}()}]),e}(),X=function(){function e(){f()(this,e)}return y()(e,null,[{key:"talk",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.listeners[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;"function"==typeof s&&s(this)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"clear",value:function(){this.products=[],this.count=0,this.sum=0,this.productsIDs={},this.talk()}},{key:"update",value:function(){var e=d()(p.a.mark(function e(t){var n,r,a,s=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=11;break}return e.next=3,Z.request("cart","info");case 3:if(n=e.sent,r=n.error,a=n.data,t=void 0===a?{}:a,!r){e.next=11;break}return J.send(r,J.type.danger),e.abrupt("return");case 11:this.products=t.products||[],this.count=t.count||0,this.sum=t.sum||0,this.productsIDs={},this.products.forEach(function(e){return s.productsIDs[e._id]=e.count}),this.talk();case 17:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"putInCart",value:function(){var e=d()(p.a.mark(function e(t,n){var r,a,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("cart","put-in-order",{productID:t._id,count:n});case 2:return r=e.sent,a=r.error,s=r.data,a?J.send(a,J.type.danger):(J.send("Количество товара ".concat(t.name," в корзине изменено"),J.type.success),this.update(s)),e.abrupt("return",!a);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"isItemInCart",value:function(e){return this.productsIDs&&this.productsIDs[e._id]}},{key:"orderPlacement",value:function(){var e=d()(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:alert("under construction");case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"listeners",get:function(){return this._listeners=this._listeners||new Set,this._listeners}}]),e}(),G=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={products:[],count:void 0,sum:void 0,show:!1},n.update=function(e){return n.setState({products:e.products,count:e.count,sum:e.sum})},n.show=function(e){return n.setState({show:!0})},n.close=function(e){return n.setState({show:!1})},n.buttons=[{name:"Оформить заказ",types:"primary",handler:function(e){n.close(),X.orderPlacement()}},{name:"закрыть",types:"secondary",handler:n.close}],n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){X.listeners.add(this.update),X.update()}},{key:"componentWillUnmount",value:function(){X.listeners.delete(this.update)}},{key:"render",value:function(){var e=this.state,t=e.products,n=e.count,r=e.sum,a=e.show;return S.a.createElement(S.a.Fragment,null,S.a.createElement(V,{className:"c--cart",open:"false",icon:!1},S.a.createElement("div",{className:"brief btn-group",role:"toggle"},S.a.createElement("span",{className:"icon cart"}),S.a.createElement("div",null,t.length>0?S.a.createElement(S.a.Fragment,null,S.a.createElement("div",null,S.a.createElement("span",{className:"icon gift-box"}),S.a.createElement("span",null,n)),S.a.createElement("div",null,S.a.createElement("span",{className:"icon money"}),S.a.createElement("span",null,r))):S.a.createElement(S.a.Fragment,null,S.a.createElement("div",null,"Корзина"),S.a.createElement("div",null,"пуста")))),S.a.createElement("div",{className:"about",role:"content"},t.length>0?S.a.createElement(S.a.Fragment,null,S.a.createElement("div",{className:"c--link",onClick:this.show},"Подробнее"),t.map(function(e,t){return S.a.createElement("div",{key:t,className:"item"},S.a.createElement("span",null,e.count),S.a.createElement(q.Link,{className:"c--link",to:"/catalog/product/".concat(e.slug)},e.name),S.a.createElement("span",null,"* ".concat(e.price," р.")),S.a.createElement("span",null,"= ".concat(e.count*e.price)))}),S.a.createElement("div",{className:"summary"},S.a.createElement("span",null,"Итого:"),S.a.createElement("span",null,n," товаров"),S.a.createElement("span",null," на сумму ",r))):S.a.createElement(S.a.Fragment,null,S.a.createElement("div",null,"Корзина"),S.a.createElement("div",null,"пуста")))),S.a.createElement($,{title:"Корзина",show:a,buttons:this.buttons,onClose:this.close},S.a.createElement("div",{className:"s--cart-modal"},t.map(function(e,t){return S.a.createElement("div",{className:"item",key:t},S.a.createElement(q.Link,{to:"/catalog/product/".concat(e.slug)},S.a.createElement("img",{alt:e.name,src:e.media[0]})),S.a.createElement("div",null,S.a.createElement(q.Link,{className:"c--link",to:"/catalog/product/".concat(e.slug)},e.name),S.a.createElement(H,{value:e.count,onChange:function(t){return X.putInCart(e,t)}}),S.a.createElement("div",null,"".concat(e.price," р.")),S.a.createElement("div",null,"Всего по позиции: ".concat(e.count*e.price))))}),S.a.createElement("div",{className:"summary"},S.a.createElement("span",null,"Итого:"),S.a.createElement("span",null,n," товаров"),S.a.createElement("span",null," на сумму ",r)))))}}]),t}(S.a.Component),Q=function(e){function t(e){var n;return f()(this,t),n=T()(this,D()(t).call(this,e)),W()(j()(j()(n)),"data",{menu:[{title:"Главная",to:"/",exact:!0},{title:"Каталог",to:"/catalog"},{title:"Акции",to:"/promotion"},{title:"Доставка и оплата",to:"/delivery"},{title:"О компании",to:"/about"},{title:"Контакты",to:"/contacts"}]}),n.state={menu:void 0},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("content","main-menu");case 2:t=e.sent,n=t.error,r=t.data,n||this.setState({menu:r});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state.menu;return S.a.createElement("nav",{className:"c--main-menu"},e?e.map(function(e,t){return S.a.createElement(q.NavLink,{key:t,to:"/".concat(e.slug),exact:""===e.slug,activeClassName:"active"},e.name)}):null)}}]),t}(S.a.Component),Y=n(19),K=n.n(Y),ee=function(){function e(){f()(this,e)}return y()(e,null,[{key:"talk",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,a=this.listeners[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var s=r.value;"function"==typeof s&&s(this)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}}},{key:"logout",value:function(){var e=d()(p.a.mark(function e(){return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:document.cookie="JWT=; path=/; expires=",document.cookie="orderJWT=; path=/; expires=",this.authorised=!1,this.about=void 0,this.permissions=void 0,X.clear(),this.talk(),J.send("Совершен выход",J.type.success);case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"login",value:function(){var e=d()(p.a.mark(function e(t){var n,r,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","login",t);case 2:if(n=e.sent,r=n.error,a=n.data,!r){e.next=12;break}return this.authorised=!1,this.about=void 0,this.permissions=void 0,this.talk(),J.send(r,J.type.danger),e.abrupt("return",!1);case 12:return this.authorised=!0,this.about=a.user,this.permissions=a.permissions,J.send("Добро пожаловать, ".concat(this.about.name),J.type.success),this.talk(),e.abrupt("return",!0);case 18:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"check",value:function(){var e=d()(p.a.mark(function e(){var t,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","check");case 2:t=e.sent,n=t.error,r=t.data,n||!r.authorised?(this.authorised=!1,this.about=void 0,this.permissions=void 0):(this.authorised=!0,this.about=r.user,this.permissions=r.permissions),this.talk();case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"registration",value:function(){var e=d()(p.a.mark(function e(t){var n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","registration",t);case 2:return n=e.sent,r=n.error,n.data,r?J.send(r,J.type.danger):J.send("На указаный почтовый адрес выслано письмо для подтверждения аккаунта",J.type.success),e.abrupt("return",!r);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"verify",value:function(){var e=d()(p.a.mark(function e(t){var n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","verify",{id:t});case 2:return n=e.sent,r=n.error,n.data,r?J.send(r,J.type.danger):J.send("Аккаунт успешно активирован",J.type.success),e.abrupt("return",!r);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"getHash",value:function(e,t){var n=new K.a("SHA-512","TEXT");return n.update(e+t),n.getHash("HEX")}},{key:"forgot",value:function(){var e=d()(p.a.mark(function e(t){var n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","forgot",t);case 2:return n=e.sent,r=n.error,n.data,r?J.send(r,J.type.danger):J.send("На указаный при регистрации адрес Вам выслано письмо с инструкциями по восстановлению пароля",J.type.success),e.abrupt("return",!r);case 7:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"changePassword",value:function(){var e=d()(p.a.mark(function e(t,n){var r,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("auth","change-password",{password:t,id:n});case 2:return r=e.sent,a=r.error,r.data,a?J.send(a,J.type.danger):J.send("Пароль успешно сменен",J.type.success),e.abrupt("return",!a);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"listeners",get:function(){return this._listeners=this._listeners||new Set,this._listeners}}]),e}(),te=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={show:!1,email:"",phone:"",name:"",lastname:"",password:"",confirm:""},n.show=function(e){return n.setState({show:!0})},n.close=function(e){return n.setState({show:!1})},n.register=function(){var e=d()(p.a.mark(function e(t){var r,a,s,o,i,u,c;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state,a=r.email,s=r.phone,o=r.name,i=r.lastname,u=r.password,c=r.confirm,a=a.trim(),s=s.trim(),o=o.trim(),i=i.trim(),a&&/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(a)){e.next=7;break}return e.abrupt("return",J.send("некорректный почтовый адрес",J.type.danger));case 7:if(s&&/^[0-9]+$/.test(s)){e.next=9;break}return e.abrupt("return",J.send("некорректный номер телефона",J.type.danger));case 9:if(o){e.next=11;break}return e.abrupt("return",J.send("некорректное имя",J.type.danger));case 11:if(i){e.next=13;break}return e.abrupt("return",J.send("некорректная фамилия",J.type.danger));case 13:if(/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/.test(u)){e.next=15;break}return e.abrupt("return",J.send("требования к паролю не выполнены",J.type.danger));case 15:if(u===c){e.next=17;break}return e.abrupt("return",J.send("пароль и его подтверждение не совпадают",J.type.danger));case 17:return e.next=19,ee.registration({email:a,phone:s,name:o,lastname:i,password:ee.getHash(a,u)});case 19:e.sent&&n.setState({show:!1,email:"",phone:"",name:"",lastname:"",password:"",confirm:""});case 21:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.buttons=[{name:"зарегистрироваться",types:"primary",handler:n.register},{name:"закрыть",types:"secondary",handler:n.close}],n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.show,r=t.email,a=t.phone,s=t.name,o=t.lastname,i=t.password,u=t.confirm;return S.a.createElement("div",null,S.a.createElement("button",{onClick:this.show,className:"c--btn c--btn--icon"},S.a.createElement("span",{className:"icon plus-in-circle"}),S.a.createElement("span",null,"Регистрация")),S.a.createElement($,{title:"Регистрация",show:n,buttons:this.buttons,onClose:this.close},S.a.createElement("div",{className:"s--registration-modal"},S.a.createElement(F,{value:r,placeholder:"почта *",type:"email",onChange:function(t){return e.setState({email:t})}}),S.a.createElement(F,{value:a,placeholder:"телефон *",type:"tel",onChange:function(t){return e.setState({phone:t})},button:S.a.createElement(V,{open:"false",icon:!1},S.a.createElement("span",{className:"icon question-in-circle",role:"toggle"}),S.a.createElement("span",{role:"content"},"только цифры"))}),S.a.createElement(F,{value:s,placeholder:"имя *",type:"name",onChange:function(t){return e.setState({name:t})}}),S.a.createElement(F,{value:o,placeholder:"фамилия *",type:"lastname",onChange:function(t){return e.setState({lastname:t})}}),S.a.createElement(F,{value:i,placeholder:"пароль *",type:"password",onChange:function(t){return e.setState({password:t})},button:S.a.createElement(V,{open:"false",icon:!1},S.a.createElement("span",{className:"icon question-in-circle",role:"toggle"}),S.a.createElement("span",{role:"content"},"латинские буквы в нижнем или верхнем регистре, цифры, знаки !@#$%^&* . Обязателен хотя бы один знак и одна цифра. Допустимая длина от 6 до 16 символов."))}),S.a.createElement(F,{value:u,placeholder:"подтверждение пароля *",type:"password",onChange:function(t){return e.setState({confirm:t})}}))))}}]),t}(S.a.Component),ne=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={show:!1,any:""},n.show=function(e){return n.setState({show:!0})},n.close=function(e){return n.setState({show:!1})},n.sendEmailOnForgot=function(){var e=d()(p.a.mark(function e(t){var r,a;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=(r=n.state.any).trim(),a=void 0,/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(r)&&(a="email"),!a&&/^[0-9]+$/.test(r)&&(a="phone"),a){e.next=7;break}return e.abrupt("return",J.send("Некорректное значение",J.type.danger));case 7:return e.next=9,ee.forgot({type:a,identificator:r});case 9:e.sent&&n.setState({show:!1,any:""});case 11:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.buttons=[{name:"восстановить пароль",types:"primary",handler:n.sendEmailOnForgot},{name:"закрыть",types:"secondary",handler:n.close}],n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"render",value:function(){var e=this,t=this.state,n=t.any,r=t.show;return S.a.createElement(S.a.Fragment,null,S.a.createElement("button",{onClick:this.show,className:"c--btn c--btn--info"},"Забыли пароль?"),S.a.createElement($,{title:"Восстановление пароля",show:r,buttons:this.buttons,onClose:this.close},S.a.createElement("div",{className:"s--forgot-modal"},S.a.createElement("div",null,"Введите номер телефона или адрес электронной почты, указанный при регистрации."),S.a.createElement(F,{value:n,placeholder:"почта * или телефон *",onChange:function(t){return e.setState({any:t})}}))))}}]),t}(S.a.Component),re=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={show:!1,email:"",password:"",redirect:!1,authorised:ee.authorised},n.update=function(e){return n.setState({authorised:e.authorised})},n.show=function(e){return n.setState({show:!0})},n.close=function(e){return n.setState({show:!1})},n.login=function(){var e=d()(p.a.mark(function e(t){var r,a,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state,a=r.email,s=r.password,(a=a.trim())&&/^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i.test(a)){e.next=4;break}return e.abrupt("return",J.send("некорректный почтовый адрес",J.type.danger));case 4:if(/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/.test(s)){e.next=6;break}return e.abrupt("return",J.send("требования к паролю не выполнены",J.type.danger));case 6:return e.next=8,ee.login({email:a,password:ee.getHash(a,s)});case 8:e.sent&&n.setState({show:!1,email:"",password:"",redirect:!0});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.buttons=[{name:"Войти",types:"primary",handler:n.login},ne,{name:"закрыть",types:"secondary",handler:n.close}],n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"render",value:function(){var e=this,t=this.state,n=t.show,r=t.email,a=t.password,s=t.redirect,o=t.authorised;return s?S.a.createElement(q.Redirect,{to:{pathname:"/account"}}):o?S.a.createElement(q.Link,{to:"/account",rel:"nofollow",className:"c--btn c--btn--icon"},S.a.createElement("span",{className:"icon plus-in-circle"}),S.a.createElement("span",null,"Кабинет")):S.a.createElement("div",null,S.a.createElement("button",{onClick:this.show,className:"c--btn c--btn--icon"},S.a.createElement("span",{className:"icon plus-in-circle"}),S.a.createElement("span",null,"Войти")),S.a.createElement($,{title:"Авторизация",show:n,buttons:this.buttons,onClose:this.close},S.a.createElement("div",{className:"s--login-modal"},S.a.createElement(F,{value:r,placeholder:"почта *",type:"email",onChange:function(t){return e.setState({email:t})}}),S.a.createElement(F,{value:a,placeholder:"пароль *",type:"password",onChange:function(t){return e.setState({password:t})},button:S.a.createElement(V,{open:"false",icon:!1},S.a.createElement("span",{className:"icon question-in-circle",role:"toggle"}),S.a.createElement("span",{role:"content"},"латинские буквы в нижнем или верхнем регистре, цифры, знаки !@#$%^&* . Обязателен хотя бы один знак и одна цифра. Допустимая длина от 6 до 16 символов."))}))))}}]),t}(S.a.Component),ae=function(e){function t(e){var n;return f()(this,t),n=T()(this,D()(t).call(this,e)),W()(j()(j()(n)),"data",{userLocation:"Москва",address:"127000, Москва, ул.Ленинградская, д.157, этаж 3, оф.378",phone:"+7-(495)-378-92-96",count:7,cost:13e4}),n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.data,t=e.userLocation,n=e.address,r=e.phone,a=e.count,s=e.cost;return S.a.createElement("header",{className:"s--header"},S.a.createElement("div",{className:"actions"},S.a.createElement("div",null,S.a.createElement("span",null,"Ваш город:"),S.a.createElement("span",null," ".concat(t))),S.a.createElement("div",null,n),S.a.createElement("div",null,r),S.a.createElement("div",null,S.a.createElement(te,null),S.a.createElement(re,null))),S.a.createElement("div",{className:"search"},S.a.createElement(L,null),S.a.createElement(P,null),S.a.createElement(G,{count:a,cost:s})),S.a.createElement("div",{className:"menu"},S.a.createElement(Q,null)))}}]),t}(S.a.Component),se=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",{className:"c--loading"},S.a.createElement("div",null,S.a.createElement("span",{className:"icon spinner"})))}}]),t}(S.a.Component),oe=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={loading:!0,page:void 0},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"componentDidUpdate",value:function(e,t,n){this.props.match.params.slug!==e.match.params.slug&&this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r,a,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0,page:void 0}),t=this.props.match.params.slug,n=void 0===t?"":t,e.next=4,Z.request("content","page",{slug:n});case 4:r=e.sent,a=r.error,s=r.data,a||this.setState({loading:!1,page:s});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.page;return t?S.a.createElement(se,null):n.title||n.content?S.a.createElement("div",{className:"s--page"},n.title?S.a.createElement("h3",null,n.title):null,n.content?S.a.createElement("div",{dangerouslySetInnerHTML:{__html:n.content}}):null):null}}]),t}(S.a.Component),ie=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={loading:!0,categoryList:[]},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("catalog","categories");case 2:t=e.sent,n=t.error,r=t.data,n||this.setState({loading:!1,categoryList:r});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.categoryList,n=e.loading;return S.a.createElement("div",{className:"s--category-list"},n?S.a.createElement(se,null):t.map(function(e,t){return S.a.createElement("div",{key:t,className:"item"},S.a.createElement("div",null,S.a.createElement("img",{alt:e.name,src:e.img})),S.a.createElement("div",null,S.a.createElement(q.Link,{to:"/catalog/".concat(e.slug)},e.name)))}))}}]),t}(S.a.Component),ue=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={inCart:X.isItemInCart(e.item)},n.update=function(e){return n.setState({inCart:e.isItemInCart(n.props.item)})},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){X.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){X.listeners.delete(this.update)}},{key:"render",value:function(){var e=this.props.item,t=this.state.inCart;return S.a.createElement("div",{className:"s--product-item"},S.a.createElement("div",null,S.a.createElement(q.Link,{to:"/catalog/product/".concat(e.slug)},S.a.createElement("img",{alt:e.name,src:e.media[0]})),S.a.createElement("div",{className:"code",title:"Артикул:".concat(e.code)},e.code),S.a.createElement("div",{className:"price",title:"Цена:".concat(e.price)},"".concat(e.price," р.")),S.a.createElement("div",{className:"in-cart",onClick:function(n){return X.putInCart(e,(t||0)+1)}},S.a.createElement("span",null,t||""),S.a.createElement("span",{className:"icon cart"}))),S.a.createElement("div",null,S.a.createElement(q.Link,{to:"/catalog/product/".concat(e.slug)},e.name),e.props.slice(0,2).map(function(e,t){return S.a.createElement("div",{key:t},"".concat(e.name,":").concat(e.value))})))}}]),t}(S.a.Component),ce=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={loading:!0,productList:[]},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"componentDidUpdate",value:function(e,t,n){this.props.match.params.slug!==e.match.params.slug&&this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r,a,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0,productList:[]}),t=this.props.match.params.slug,n=void 0===t?"":t,e.next=4,Z.request("catalog","category",{slug:n});case 4:r=e.sent,a=r.error,s=r.data,a||this.setState({loading:!1,productList:s});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.productList,n=void 0===t?[]:t;return e.loading?S.a.createElement(se,null):S.a.createElement("div",{className:"s--products-list"},n.length>0?n.map(function(e,t){return S.a.createElement(ue,{key:t,item:e})}):"nothing to show")}}]),t}(S.a.Component),le=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={loading:!0,product:void 0},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"componentDidUpdate",value:function(e,t,n){this.props.match.params.slug!==e.match.params.slug&&this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r,a,s;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({loading:!0,product:void 0}),t=this.props.match.params.slug,n=void 0===t?"":t,e.next=4,Z.request("catalog","product",{slug:n});case 4:r=e.sent,a=r.error,s=r.data,a||this.setState({loading:!1,product:s});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.product,n=e.loading;return S.a.createElement("div",{className:"s--product"},n?S.a.createElement(se,null):t?S.a.createElement("div",{className:"item"},S.a.createElement("div",null,S.a.createElement("img",{alt:t.name,src:t.media[0]})),S.a.createElement("div",null,S.a.createElement("h4",{to:"/catalog/product/".concat(t.slug)},t.name),S.a.createElement("div",null,"Артикул:",t.code),S.a.createElement("div",null,"Цена:",t.price),t.props.map(function(e,t){return S.a.createElement("div",{key:t},"".concat(e.name,":").concat(e.value))}))):"nothing to show")}}]),t}(S.a.Component),pe=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement(q.Switch,null,S.a.createElement(q.Route,{exact:!0,path:"/catalog",component:ie}),S.a.createElement(q.Route,{exact:!0,path:"/catalog/:slug",component:ce}),S.a.createElement(q.Route,{exact:!0,path:"/catalog/product/:slug",component:le}))}}]),t}(S.a.Component),me=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("main",{className:"s--main"},S.a.createElement(q.Switch,null,S.a.createElement(q.Route,{exact:!0,path:"/:slug",component:oe}),S.a.createElement(q.Route,{exact:!0,path:"/",component:oe})),S.a.createElement(q.Switch,null,S.a.createElement(q.Route,{path:"/catalog",component:pe})))}}]),t}(S.a.Component),de=function(e){function t(e){var n;return f()(this,t),n=T()(this,D()(t).call(this,e)),W()(j()(j()(n)),"data",{footerContacts:{title:"Контакты",address:"127000, Москва, ул.Ленинградская, д.157, этаж 3, оф.378",phone:"+7 (495)378-92-96"},footerLinks:[{title:"Компания",links:[{title:"О компании",url:"/about"},{title:"Новости",url:"/news"},{title:"Вакансии",url:"/jobs"}]},{title:"Информация",links:[{title:"Помощь",url:"/help"},{title:"Оплата и доставка",url:"/info"},{title:"Гарантия на товар",url:"/warrantly"}]},{title:"Помощь",links:[{title:"Блог",url:"/blog"},{title:"Вопрос-ответ",url:"/faq"},{title:"Бренды",url:"/brends"}]}]}),n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.data,t=e.footerLinks,n=e.footerContacts;return S.a.createElement("footer",{className:"s--footer"},S.a.createElement("div",{className:"links"},t.map(function(e,t){return S.a.createElement("div",{key:t},S.a.createElement("h5",null,e.title),S.a.createElement("div",null,e.links.map(function(e,t){return S.a.createElement(q.Link,{key:t,to:e.url},e.title)})))}),S.a.createElement("div",null,S.a.createElement("h5",null,n.title),S.a.createElement("div",null,S.a.createElement("span",null,n.address),S.a.createElement("span",null,n.phone)))),S.a.createElement("div",{className:"rights"},S.a.createElement("span",null,"2017 © ForMeToo. Все права защищены.")))}}]),t}(S.a.Component),he=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&window.scrollTo(0,0)}},{key:"render",value:function(){return S.a.createElement(S.a.Fragment,null,S.a.createElement(ae,null),S.a.createElement(me,null),S.a.createElement(de,null))}}]),t}(S.a.Component),fe=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={about:ee.about||{}},n.update=function(e){return n.setState({about:e.about})},n.logout=function(e){return ee.logout()},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"render",value:function(){var e=this.state.about;return S.a.createElement("header",{className:"a--header"},S.a.createElement("div",{className:"info"},S.a.createElement(L,null),S.a.createElement("div",{className:"about"},"".concat(e.name," ").concat(e.lastname))),S.a.createElement("div",{className:"actions"},S.a.createElement(q.Link,{to:"/"},"на главную"),S.a.createElement("button",{className:"c--btn c--btn--danger",onClick:this.logout},"Выход")))}}]),t}(S.a.Component),ve=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={permissions:ee.permissions},n.update=function(e){return n.setState({permissions:e.permissions})},n.translate={client:"Текущий пользователь",media:"Медиа",tabs:"Табы",attributes:"Атрибуты",orders:"Заказы",users:"Пользователи",roles:"Роли",categories:"Категории",products:"Продукты",pages:"Страницы",settings:"Настройки",logs:"Логи"},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"render",value:function(){var e=this,t=this.state.permissions;return S.a.createElement("div",{className:"a--sections"},t.map(function(t,n){return S.a.createElement(q.NavLink,{to:"/account/".concat(t),key:n},e.translate[t]||t)}))}}]),t}(S.a.Component),ye=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница текущего пользователя (для клиентов отображается только она, без боковой панели и в ней вся работа с заказами и прочим)\\nНе готово.")}}]),t}(S.a.Component),ge=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница атрибутов\\nНе готово.")}}]),t}(S.a.Component),ke=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница управления категориями\\nНе готово.")}}]),t}(S.a.Component),Ee=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница логов пользователей сайта\\nНе готово.")}}]),t}(S.a.Component),be=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница медиа-файлов\\nНе готово.")}}]),t}(S.a.Component),we=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница заказов\\nНе готово.")}}]),t}(S.a.Component),xe=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница управления содержимым страниц\\nНе готово.")}}]),t}(S.a.Component),Se=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница управления продуктами\\nНе готово.")}}]),t}(S.a.Component),Ce=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={loading:!0,rolesList:[]},console.log(0),n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){this.getInitialDataFromSrv()}},{key:"getInitialDataFromSrv",value:function(){var e=d()(p.a.mark(function e(){var t,n,r;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z.request("roles","list");case 2:t=e.sent,n=t.error,r=t.data,n||this.setState({loading:!1,rolesList:r});case 6:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.loading,n=e.rolesList;return t?S.a.createElement(se,null):n.map(function(e,t){return S.a.createElement("div",{className:"c--list-item",key:t},S.a.createElement("div",null,e.name),S.a.createElement("div",{className:"icon"}))})}}]),t}(S.a.Component),Ne=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this.props,t=e.links,n=void 0===t?[]:t,r=e.redirect;return S.a.createElement(S.a.Fragment,null,n.length>0?S.a.createElement("div",{className:"c--tabs-links"},n.map(function(e,t){return S.a.createElement(q.Link,{key:t,to:e.path},e.title)})):null,S.a.createElement("div",{className:"c--tabs-content"},S.a.createElement(q.Switch,null,r?S.a.createElement(q.Route,{exact:!0,path:r.from,render:function(e){return S.a.createElement(q.Redirect,{to:r.to})}}):null,n.map(function(e,t){return S.a.createElement(q.Route,{exact:!0,key:t,path:e.path,component:e.component})}))))}}]),t}(S.a.Component),qe=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).rootPath="/account/roles",n.links=[{path:n.rootPath+"/list",title:"Список ролей",component:Ce}],n}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,S.a.createElement(Ne,{links:this.links,redirect:{from:this.rootPath,to:this.links[0].path}}))}}]),t}(S.a.Component),Ie=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница общих настроек сайта\\nНе готово.")}}]),t}(S.a.Component),Te=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница табов\\nНе готово.")}}]),t}(S.a.Component),Oe=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"render",value:function(){return S.a.createElement("div",null,"Страница управления пользователями\\nНе готово.")}}]),t}(S.a.Component),De=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={permissions:ee.permissions},n.update=function(e){return n.setState({permissions:e.permissions})},n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update)}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"render",value:function(){var e=this.state.permissions;return S.a.createElement("main",{className:"a--main"},e.length>1?S.a.createElement(ve,null):null,S.a.createElement(q.Switch,null,S.a.createElement(q.Route,{path:"/account/client",component:ye}),S.a.createElement(q.Route,{path:"/account/attributes",component:ge}),S.a.createElement(q.Route,{path:"/account/categories",component:ke}),S.a.createElement(q.Route,{path:"/account/logs",component:Ee}),S.a.createElement(q.Route,{path:"/account/media",component:be}),S.a.createElement(q.Route,{path:"/account/orders",component:we}),S.a.createElement(q.Route,{path:"/account/pages",component:xe}),S.a.createElement(q.Route,{path:"/account/products",component:Se}),S.a.createElement(q.Route,{path:"/account/roles",component:qe}),S.a.createElement(q.Route,{path:"/account/settings",component:Ie}),S.a.createElement(q.Route,{path:"/account/tabs",component:Te}),S.a.createElement(q.Route,{path:"/account/users",component:Oe}),S.a.createElement(q.Route,{exact:!0,path:"/account",render:function(t){return S.a.createElement(q.Redirect,{to:"/account/".concat(e[0])})}})))}}]),t}(S.a.Component),_e=function(e){function t(e){var n;f()(this,t),(n=T()(this,D()(t).call(this,e))).state={checked:!1,authorised:!1,permissions:[],redirectByTimeout:!1};var r=setTimeout(function(){return n.setState({redirectByTimeout:!0})},5e3);return n.update=function(e){clearTimeout(r),n.setState({checked:!0,authorised:e.authorised,permissions:e.permissions||[]})},n.redirect=S.a.createElement(q.Redirect,{to:{pathname:"/"}}),n}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){ee.listeners.add(this.update),ee.check()}},{key:"componentWillUnmount",value:function(){ee.listeners.delete(this.update)}},{key:"componentDidUpdate",value:function(e){this.props.location!==e.location&&window.scrollTo(0,0)}},{key:"render",value:function(){var e=this.state,t=e.checked,n=e.authorised,r=e.permissions;return e.redirectByTimeout?this.redirect:t?n?0===r.length?this.redirect:S.a.createElement(S.a.Fragment,null,S.a.createElement(fe,null),S.a.createElement(De,null)):this.redirect:S.a.createElement(se,null)}}]),t}(S.a.Component),Be=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={redirect:!1,message:"Пожалуйста, подождите, выполняется подтверждение аккаунта"},n}return B()(t,e),y()(t,[{key:"componentDidMount",value:function(){this.verification()}},{key:"verification",value:function(){var e=d()(p.a.mark(function e(){var t,n,r=this;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=(this.props.match||{}).params||{},n=t.id,e.next=3,ee.verify(n);case 3:if(e.sent){e.next=5;break}return e.abrupt("return");case 5:this.setState({message:"Аккаунт успешно активирован"}),setTimeout(function(){return r.setState({redirect:!0})},3e3);case 7:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this.state,t=e.redirect,n=e.message;return t?S.a.createElement(q.Redirect,{to:{pathname:"/account"}}):S.a.createElement($,{title:"Подтверждение аккаунта",show:!0},S.a.createElement("div",{className:"s--verify-modal"},S.a.createElement("div",null,n)))}}]),t}(S.a.Component),Re=function(e){function t(e){var n;return f()(this,t),(n=T()(this,D()(t).call(this,e))).state={redirect:!1,password:"",confirm:""},n.changePassword=function(){var e=d()(p.a.mark(function e(t){var r,a,s,o,i,u;return p.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=n.state,a=r.password,s=r.confirm,o=(n.props.match||{}).params||{},i=o.id,u=o.email,/^(?=.*[0-9])(?=.*[!@#$%^&*])[a-zA-Z0-9!@#$%^&*]{6,16}$/.test(a)){e.next=4;break}return e.abrupt("return",J.send("требования к паролю не выполнены",J.type.danger));case 4:if(a===s){e.next=6;break}return e.abrupt("return",J.send("пароль и его подтверждение не совпадают",J.type.danger));case 6:return e.next=8,ee.changePassword({id:i,password:ee.getHash(u,a)});case 8:e.sent&&n.setState({redirect:!0});case 10:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.buttons=[{name:"Подтвердить новый пароль",types:"primary",handler:n.changePassword}],n}return B()(t,e),y()(t,[{key:"render",value:function(){var e=this,t=this.state,n=t.redirect,r=t.password,a=t.confirm,s=((this.props.match||{}).params||{}).email;return n?S.a.createElement(q.Redirect,{to:{pathname:"/"}}):S.a.createElement($,{title:"Изменение пароля для аккаунта ".concat(s),show:!0,buttons:this.buttons},S.a.createElement("div",{className:"s--recovery-modal"},S.a.createElement(F,{value:r,placeholder:"пароль *",type:"password",onChange:function(t){return e.setState({password:t})},button:S.a.createElement(V,{open:"false",icon:!1},S.a.createElement("span",{className:"icon question-in-circle",role:"toggle"}),S.a.createElement("span",{role:"content"},"латинские буквы в нижнем или верхнем регистре, цифры, знаки !@#$%^&* . Обязателен хотя бы один знак и одна цифра. Допустимая длина от 6 до 16 символов."))}),S.a.createElement(F,{value:a,placeholder:"подтверждение пароля *",type:"password",onChange:function(t){return e.setState({confirm:t})}})))}}]),t}(S.a.Component),je=function(e){function t(e){return f()(this,t),T()(this,D()(t).call(this,e))}return B()(t,e),y()(t,[{key:"componentWillMount",value:function(){$.registerRootID("modal-root"),J.registerRootID("message-root"),ee.check()}},{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return S.a.createElement(S.a.Fragment,null,S.a.createElement(q.Switch,null,S.a.createElement(q.Route,{exact:!0,path:"/account/verify/:id",component:Be}),S.a.createElement(q.Route,{exact:!0,path:"/account/recovery/:email/:id",component:Re}),S.a.createElement(q.Route,{path:"/account",component:_e}),S.a.createElement(q.Route,{path:"/",component:he})),S.a.createElement(J,null))}}]),t}(S.a.Component),Me=n(21),We=n(26);w.init();var Le=a()(),Fe=a.a.Router();Fe.use(a.a.static(o.a.resolve("build","public"),{maxAge:"30d"})),Fe.get("*",function(e,t,n){console.log("===render===",e.url);var r=Me.resolve("build","index.html");We.readFile(r,"utf8",function(n,r){if(n)return console.error("err",n),t.status(404).end();var a={status:200},s=N.a.renderToString(S.a.createElement(q.StaticRouter,{basename:"",location:e.url,context:a},S.a.createElement(je,null)));return t.status(a.status).send(r.replace('<div id="app"></div>','<div id="app">'.concat(s,"</div>")))})}),Fe.use(u()()),Fe.use(a.a.json()),Fe.post("/api/",w.router),Le.use(Fe),Le.listen(c.a.connection.port,function(e){if(e)return console.log("something bad happened",e);console.log("listening on "+c.a.connection.port+"...")})}]);